当函数组件进入render阶段时，会被renderWithHooks函数处理。函数组件作为一个函数，它的渲染其实就是函数调用，它内部调用了React提供的hooks函数。初始挂载和更新时，所用的hooks
函数是不同的，但它们都由`ReactCurrentDispatcher`来提供，hooks函数存储在其current属性中。

所以在调用函数组件之前，当务之急是根据当前所处的阶段来决定ReactCurrentDispatcher的current。

```javascript
export function renderWithHooks<Props, SecondAwrg>(
  current: Fiber | null,
  workInProgress: Fiber,
  Component: (p: Props, arg: SecondArg) => any,
  props: Props,
  secondArg: SecondArg,
  nextRenderLanes: Lanes,
): any {
  
  // 区分是挂载还是更新过程，获取不同的hooks集合
  ReactCurrentDispatcher.current =
        current === null || current.memoizedState === null
          ? HooksDispatcherOnMount
          : HooksDispatcherOnUpdate;
  // 调用函数组件，
  let children = Component(props, secondArg);
  ...
  return children;
}
```

# hook的初始化和更新
每调用一次hooks函数，都有一个hook对象与之对应，它们依次排列，形成链表存储到函数组件fiber的memoizedState上。在这个过程中，有一个十分重要的指针：
**workInProgressHook**，它通过记录当前生成（更新）的hook对象，可以间接反映在组件中当前调用到哪个hook函数了。每调用一次hook函数，就将这个指针
的指向移到最新的hook对象上。例如：
```javascript
const HooksExp = () => {
    const [ stateHookA, setHookA ] = useState('A')
    useEffect(() => { console.log('B') })
    const [ stateHookC, setHookC ] = useState('C')
    return <div>Hook Example</div>
}
```
上面的例子中，HooksExp组件内一共调用了三个hooks函数，分别是useState、useEffect、useState。

## 初次挂载过程
组件初次挂载时构建hook链表的过程，可以概括为下面这样，重点关注workInProgressHook的指向变化。

调用useState('A')：
```
fiber.memoizedState: hookA
                       ^
                workInProgressHook
```
调用useEffect：
```
fiber.memoizedState: hookA -> hookB
                                ^
                         workInProgressHook
```
调用useState('C')：
```
fiber.memoizedState: hookA -> hookB -> hookC
                                         ^
                                 workInProgressHook
```
## 后续更新过程
在更新过程中，需要另一个指针的参与：currentHook。它作为上一次更新时的hook对象，新的hook对象可以基于它创建，另外，也可以获取到上次hook对象的一些数据，例如useEffect的
前后依赖项比较，前一次的依赖项就可以这样获得。

```                      
                currentTree

current.memoizedState = hookA -> hookB -> hookC
                                   ^             
                               currentHook
                                   |
         workInProgress Tree       |
                                   |                                
    wip.memoizedState = hookA -> hookB-> hookC
                                   ^          
                           workInProgressHook    
                                     

```


