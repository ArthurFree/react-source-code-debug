React原理，从更新说起。

作为一个构建用户界面的库，React的核心始终围绕着更新这一个重要的目标，将更新和极致的用户体验结合起来是React团队一直在努力的事情。为什么React可以将用户体验做到这么好？我想这是基于以下两点原因：

* Fiber架构和Scheduler出色的调度模式可以实现异步可中断的更新行为。
* 优先级机制贯穿更新的整个周期

下面我们基于这两点展开，在解读原理之前，对一些概念先有个基础认知。
# Fiber是什么
Fiber是什么？它是React的最小工作单元，在React的世界中，一切都可以是组件。在普通的HTML页面上，人为地将多个DOM元素整合在一起可以组成一个组件，HTML标签可以是组件（HostComponent），
普通的文本节点也可以是组件（HostText）。每一个组件就对应着一个fiber节点，许多个fiber节点互相嵌套、关联，就组成了fiber树，正如下面表示的Fiber树和DOM的关系一样：
```
    Fiber树                    DOM树

   div#root                  div#root
      |                         |
    <App/>                     div
      |                       /   \
     div                     p     a
    /   ↖
   /      ↖
  p ----> <Child/>
             |
             a
  
```
一个DOM节点一定对应着一个Fiber节点，但一个Fiber节点却不一定有对应的DOM节点。

每一个fiber节点都可能会产生更新，每当有更新的时候，React都会从root开始重新构建fiber树。这个行为，就是React的更新任务。对Fiber树来说，一旦有一个更新任务，它就会经历一个深度优先遍历的过程，
依照现有fiber树构建一个新的fiber树，现有fiber树称为current树，构建的新fiber树称为workInProgress树。整个fiber树会经历向下遍历以及向上回溯的两个过程，所以每个fiber节点，也会经历两个过程：
**beginWork**和**completeWork**。**构建过程中会有一个workInProgress的指针记录下当前构建到哪个fiber节点**，这是React更新任务可恢复的重要原因之一。fiber树的构建过程如下动图：

![fiberTask](http://neroht.com/fiberTask4.gif)


# 双缓冲机制
双缓冲机制

